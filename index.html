<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Dashboard Gaji Berkala</title>
<style>
body{margin:0;font-family:system-ui;background:#f6f8fa}
header{background:#24292f;color:#fff;padding:16px 40px;display:flex;gap:16px;align-items:center}
header a{background:#0969da;color:#fff;text-decoration:none;padding:8px 14px;border-radius:6px;font-weight:600}
.container{padding:24px 40px}
.toolbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.search input{padding:8px 12px;width:280px;border:1px solid #d0d7de;border-radius:6px}
.notice{background:#fff3cd;color:#664d03;padding:10px 16px;border-radius:6px;font-weight:600}
table{width:100%;border-collapse:collapse;background:#fff;box-shadow:0 6px 18px rgba(0,0,0,.08)}
th{background:#0969da;color:#fff;padding:12px;text-align:left}
td{padding:10px;border-bottom:1px solid #eaecef}
tr:hover{background:#f0f6fc}
input,select{width:100%;padding:7px;border:1px solid #d0d7de;border-radius:6px}
.badge{background:#ddf4ff;color:#0969da;padding:4px 8px;border-radius:20px}
.btn{background:#2da44e;color:#fff;padding:6px 12px;border-radius:6px;text-decoration:none}
.paging{text-align:right;margin-top:10px}
.paging button{padding:6px 12px;border:1px solid #d0d7de;border-radius:6px;background:#fff;cursor:pointer}
#loading{position:fixed;inset:0;background:rgba(255,255,255,.85);display:flex;align-items:center;justify-content:center;font-size:22px;font-weight:600}
</style>
</head>

<body>
<div id="loading">Loading Dashboard…</div>

<header>
  <a href="https://rikoantah.github.io/Dasboard-Kepegawaian/">⬅ Back</a>
  <h2>Dashboard Gaji Berkala</h2>
</header>

<div class="container">
  <div class="toolbar">
    <div class="search">
      <input id="q" placeholder="Cari Nama…" onkeyup="search()">
    </div>
    <div id="notif"></div>
  </div>

  <table>
    <thead>
      <tr>
        <th>Nama</th><th>NIP</th><th>Gol</th><th>Jabatan</th>
        <th>Folder</th><th>Waktu</th><th>Catatan</th><th>No Surat</th>
      </tr>
    </thead>
    <tbody id="tbody"></tbody>
  </table>

  <div class="paging">
    <button onclick="prev()">Prev</button>
    <button onclick="next()">Next</button>
  </div>
</div>

<script>
const GAS_URL = "https://script.google.com/macros/s/AKfycbwJ3BKtCDa3kcH0aqmXcS1OZDkVTvfSUrKO7zYYfvOUTn9KGZwyOaMC0MKk0Qmf_76W/exec";
let page=1, q="", DROPDOWN=[];

Promise.all([
  fetch(GAS_URL+"?type=dropdown").then(r=>r.json()),
  load()
]).then(d=>DROPDOWN=d[0]);

function load(){
  document.getElementById("loading").style.display="flex";
  return fetch(`${GAS_URL}?page=${page}&q=${encodeURIComponent(q)}`)
    .then(r=>r.json())
    .then(draw);
}

function draw(res){
  const tb=document.getElementById("tbody");
  tb.innerHTML="";
  res.rows.forEach(r=>{
    tb.innerHTML+=`
      <tr>
        <td><b>${r.nama}</b></td>
        <td>${r.nip}</td>
        <td><span class="badge">${r.gol}</span></td>
        <td>${r.jabatan}</td>
        <td>${r.folder?`<a class="btn" target="_blank" href="${r.folder}">Buka</a>`:"-"}</td>
        <td>${r.waktu||"-"}</td>
        <td>
          <select onchange="update(${r.row},'catatan',this.value)">
            ${DROPDOWN.map(d=>`<option ${d===r.catatan?'selected':''}>${d}</option>`).join("")}
          </select>
        </td>
        <td>
          <input value="${r.nosurat||""}" onchange="update(${r.row},'nosurat',this.value)">
        </td>
      </tr>`;
  });
  document.getElementById("notif").innerHTML =
    res.pending>0 ? `<div class="notice">⚠️ Ada ${res.pending} KGB belum dikerjakan</div>` : "";
  document.getElementById("loading").style.display="none";
}

function update(row,field,value){
  fetch(GAS_URL,{
    method:"POST",
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({row,field,value})
  }).then(r=>r.json()).then(res=>{
    if(!res.success) alert("Gagal menyimpan ke Sheet");
  });
}
function next(){page++;load()}
function prev(){if(page>1){page--;load()}}
function search(){q=document.getElementById("q").value;page=1;load()}
</script>
</body>
</html>
